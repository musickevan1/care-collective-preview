# Fix Plan: Admin CMS Type Constraints

> Generated by @prompt-builder on 2025-12-27
> Priority: MEDIUM
> Estimated Fix Time: 2-4 hours

## Original Issue

**Error:** 30+ TypeScript errors related to Admin CMS
**Issue:** Type constraints not including new CMS tables (calendar_events, community_updates, etc.)
**Impact:** Admin features type-unsafe

## Root Cause Analysis

The admin CMS has been enhanced with new tables and features, but the type constraints haven't been updated to include:

1. **New tables:** calendar_events, community_updates, and possibly others
2. **Type extensions:** Zod schemas and TypeScript interfaces for new tables
3. **Admin-specific types:** Types used in admin routes and components

This is similar to the database types issue but specific to admin functionality and potentially includes custom validation schemas.

## Target Agent

`@api-designer` - Database schema, type constraints, Zod validation

---

## Prompt

### Problem Statement

Admin CMS features have 30+ TypeScript errors because type constraints don't include new CMS tables (calendar_events, community_updates, etc.). Need to update type constraints and schemas to match the current admin database structure.

### Technical Context

- **Admin location:** `/app/admin/` directory
- **CMS tables:** calendar_events, community_updates, and possibly others
- **Type validation:** Likely uses Zod schemas for runtime validation
- **Admin components:** Located in `/components/admin/`
- **Database types:** Should align with regenerated `lib/database.types.ts` from fix #2

### Implementation Requirements

#### Phase 1: Analyze Admin Type Errors (45 min)
1. Run TypeScript type check and filter for admin errors:
   ```bash
   npm run type-check 2>&1 | grep -i admin
   ```
2. Read admin route files:
   - `/app/admin/page.tsx`
   - `/app/admin/calendar-events/` (if exists)
   - `/app/admin/community-updates/` (if exists)
   - Other admin routes
3. Identify which tables are missing from types:
   - calendar_events
   - community_updates
   - Any other CMS tables
4. Check if there are Zod schemas for admin validation:
   ```bash
   rg "z\.object|z\.enum|z\.string" lib/ --type ts -A 5
   ```

#### Phase 2: Check Database Schema (30 min)
1. Verify CMS tables exist in Supabase:
   ```bash
   supabase db dump --schema public --data-only | grep -E "CREATE TABLE|calendar_events|community_updates"
   ```
2. Check migration files for CMS tables:
   ```bash
   ls -la supabase/migrations/ | grep -i cms
   ```
3. Document the structure of each CMS table (columns, types, constraints)

#### Phase 3: Update Type Constraints (60 min)
1. Ensure `lib/database.types.ts` (from fix #2) includes CMS tables
2. Create or update admin-specific type extensions if needed:
   ```typescript
   // lib/types/admin.ts
   export interface CalendarEvent {
     id: string
     title: string
     description?: string
     event_date: string
     location?: string
     created_at: string
     updated_at: string
   }

   export interface CommunityUpdate {
     id: string
     title: string
     content: string
     published: boolean
     created_at: string
     updated_at: string
   }
   ```

#### Phase 4: Create/Update Zod Schemas (60 min)
1. Create Zod schemas for CMS tables:
   ```typescript
   // lib/validations/admin.ts
   import { z } from 'zod'

   export const calendarEventSchema = z.object({
     id: z.string().uuid(),
     title: z.string().min(1).max(200),
     description: z.string().max(1000).optional(),
     event_date: z.string().datetime(),
     location: z.string().max(500).optional(),
     created_at: z.string().datetime(),
     updated_at: z.string().datetime(),
   })

   export const communityUpdateSchema = z.object({
     id: z.string().uuid(),
     title: z.string().min(1).max(200),
     content: z.string().min(1).max(5000),
     published: z.boolean(),
     created_at: z.string().datetime(),
     updated_at: z.string().datetime(),
   })
   ```
2. Update existing admin schemas to include new tables
3. Create form input schemas (partial schemas for create/update):
   ```typescript
   export const createCalendarEventSchema = calendarEventSchema.pick({
     title: true,
     description: true,
     event_date: true,
     location: true,
   })
   ```

#### Phase 5: Update Admin Components (45 min)
1. Update admin components to use new types:
   - `/components/admin/CalendarEventForm.tsx`
   - `/components/admin/CommunityUpdateForm.tsx`
   - Other admin components
2. Ensure proper type safety:
   - Props are typed correctly
   - State is typed correctly
   - API responses are validated with Zod schemas
3. Check admin routes for type errors and fix them

#### Phase 6: Test (30 min)
1. Run TypeScript type check for admin routes:
   ```bash
   npm run type-check 2>&1 | grep -i admin
   ```
2. Verify no admin-related type errors remain
3. Test admin functionality in development:
   - Can create calendar events
   - Can create community updates
   - Can edit CMS content
   - Forms validate properly

### Acceptance Criteria

1. ✅ All admin-related TypeScript errors resolved (0 errors)
2. ✅ Type constraints include all CMS tables (calendar_events, community_updates, etc.)
3. ✅ Zod schemas created for all CMS tables
4. ✅ Admin components are type-safe
5. ✅ Forms validate properly with Zod schemas
6. ✅ Admin features work without type errors
7. ✅ Production build succeeds without admin type errors

### Files to Modify

1. `lib/types/admin.ts` - Create or update admin type definitions
2. `lib/validations/admin.ts` - Create or update Zod schemas
3. `/components/admin/*.tsx` - Update admin components with proper types
4. `/app/admin/**/*.tsx` - Update admin routes with proper types

### Files to Read (Analysis)

1. `/app/admin/page.tsx`
2. `/app/admin/calendar-events/page.tsx` (if exists)
3. `/app/admin/community-updates/page.tsx` (if exists)
4. `/components/admin/*.tsx`
5. Supabase migrations for CMS tables
6. Current Zod schemas: `lib/validations/*.ts`

### Testing Strategy

1. **Type check:** Run `npm run type-check` to verify all admin errors resolved
2. **Build test:** Run `npm run build` to ensure admin pages build correctly
3. **Runtime test:** Test admin features in development:
   - Create calendar event
   - Create community update
   - Edit existing content
   - Verify form validation works

### Dependencies

- **Blocks on:** Database types regeneration (fix #2) - CMS types should align with regenerated database types
- **Can be done in parallel:** Can be done in parallel with integration tests (fix #3) after database types are fixed
- **No other dependencies:** Independent of middleware and integration tests

### Potential Risks & Mitigation

| Risk | Probability | Impact | Mitigation |
|------|-------------|--------|------------|
| CMS table structure differs from assumptions | Medium | Medium | Check actual database schema before creating types |
| Zod schemas are too strict and break existing code | Low | Medium | Test admin features thoroughly after adding schemas |
| Missing admin-specific validation rules | Medium | Low | Review admin requirements to ensure all validations captured |
| Type updates break backward compatibility | Low | Medium | Test all admin features after type updates |

### Rollback Plan

If type updates cause issues:
1. Keep original admin type files backed up
2. Revert to original types
3. Apply targeted fixes instead of comprehensive type updates

### Additional Context

- **Priority:** MEDIUM - Admin features, not critical for basic user flows
- **Scope:** Focus on CMS tables: calendar_events, community_updates, and any others
- **Validation:** Zod schemas provide both runtime and compile-time type safety
- **Consistency:** Align with patterns used in other parts of the application

### CMS Tables Likely Present

Based on error context:
- `calendar_events` - Events calendar
- `community_updates` - Blog/news updates
- Potentially others: `resources`, `announcements`, etc.

### Type Safety Goals

1. **Database alignment:** Types match actual database schema
2. **Form validation:** Zod schemas for create/update forms
3. **Component safety:** Props and state properly typed
4. **API safety:** Response data validated before use

### Questions for the Agent

1. Are there other CMS tables not mentioned that need type coverage?
2. Should admin types be in a separate file or integrated with database types?
3. Are there admin-specific validation rules beyond database constraints?

### Success Metrics

- Admin-related TypeScript errors: 0
- CMS tables with Zod schemas: 100% coverage
- Admin features type-safe: 100%
- Admin forms validate properly: 100%
